import express from 'express';
import passport from '../config/passport';
import { signin, signup, me } from '../controllers/authController';
import { googleCallback } from '../controllers/oauthController';
import { usermiddleware } from '../middlewares/authmiddleware';

export const authRouter = express.Router();

authRouter.post('/signup', signup);
authRouter.post('/signin', signin);
authRouter.get('/me', usermiddleware, me);

authRouter.get('/google', 
  passport.authenticate('google', { scope: ['profile', 'email'] })
);

authRouter.get('/google/callback', 
  passport.authenticate('google', { 
    failureRedirect: `${process.env.CLIENT_URL}/login?error=oauth_failed` 
  }),
  googleCallback
);

authRouter.post('/logout', (req, res) => {
  req.logout((err) => {
    if (err) {
      return res.status(500).json({ error: 'Logout failed' });
    }
    res.json({ message: 'Logged out successfully' });
  });
});